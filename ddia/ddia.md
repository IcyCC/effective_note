
# 数据复制

## 主从复制:
只有主节点可写的

## 同步和异步复制
是否等从节点确认

## 不停机配置新的从节点流程:
1. 对主节点进行一致性快照
2. 快照到新节点
3. 向主节点请求快照点位置之后所有日志
4. 进行处理

## 节点切换
1. 确认失效
2. 选举新的主节点
3. 配置新的节点
问题:
1. 异步复制, 新节点成为主节点时, 旧节点比新节点数据新. 旧节点给新节点同步数据冲突. 
2. 基于问题 1, 如果丢弃数据会导致外部系统不一致. 如同一个 key 的数据缓存和 db 不一致.
3. 两个节点同时成为主节点 发生脑裂
4. 如何检测主节点失效?

## 复制日志的实现

1. 语句级别: 存在非确定函数, 自增列数据, 副总用函数的问题
2. wal 日志: 泰国底层, 贴近物理描述
3. 逻辑日志: 解耦逻辑日志和物理日志

## 复制滞后

写后读一致性
* 强制从主节点
* 记录更新时间, 看时间范围决定是否从主节点读

## 单调读